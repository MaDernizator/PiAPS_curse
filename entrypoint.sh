#!/bin/bash

echo "üîÑ –ñ–¥—ë–º, –ø–æ–∫–∞ –ë–î —Å—Ç–∞–Ω–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–∞ ($DB_HOST:$DB_PORT)..."
while ! nc -z "$DB_HOST" "$DB_PORT"; do
  sleep 1
done

echo "‚úÖ –ë–î –¥–æ—Å—Ç—É–ø–Ω–∞, –∑–∞–ø—É—Å–∫–∞–µ–º –º–∏–≥—Ä–∞—Ü–∏–∏"
flask db upgrade

echo "‚åõ –ñ–¥—ë–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–π"
sleep 10  # ‚¨ÖÔ∏è –î–∞–π –º–∏–≥—Ä–∞—Ü–∏—è–º –Ω–µ–º–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏

echo "üë§ –°–æ–∑–¥–∞–Ω–∏–µ —Å—É–ø–µ—Ä–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"
flask create-superuser

echo "üöÄ –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞"
exec flask run --host=0.0.0.0 --port=5000